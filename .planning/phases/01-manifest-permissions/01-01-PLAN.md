# Plan 01-01: Add History Permission to Manifest

**Phase**: 1 - Manifest & Permissions
**Plan**: 01-01
**Status**: Ready to execute
**Created**: 2026-01-09

## Objective

Add Chrome `history` permission to manifest.json to enable access to the Chrome History API for retrieving frequently visited websites.

## Context

**Current State:**
- manifest.json exists at project root (manifest.json:1)
- Current permissions array contains only "storage" (manifest.json:7-9)
- CSP already configured for extension pages (manifest.json:32-34)
- Manifest V3 format (manifest.json:2)

**Why This Matters:**
- Chrome History API requires explicit "history" permission
- Without this permission, chrome.history.* calls will fail
- This is a prerequisite for Phase 2 (History Service implementation)

**Dependencies:**
- None (first phase)

## Tasks

### Task 1: Add history permission to manifest.json

**What**: Add "history" to the permissions array in manifest.json

**How**:
1. Edit manifest.json:7-9 (permissions array)
2. Add "history" as second item in array
3. Result should be:
   ```json
   "permissions": [
     "storage",
     "history"
   ],
   ```

**Files Modified**:
- manifest.json

**Success Criteria**:
- [ ] "history" permission present in permissions array
- [ ] manifest.json is valid JSON (no syntax errors)
- [ ] dist/manifest.json will be updated on next build

### Task 2: Verify CSP compatibility

**What**: Confirm Content Security Policy doesn't block history API usage

**How**:
1. Review current CSP in manifest.json:32-34
2. Verify "script-src 'self'" allows chrome.history API calls
3. No changes needed (chrome.* APIs not blocked by CSP)

**Files Modified**:
- None (verification only)

**Success Criteria**:
- [ ] CSP allows chrome.history API usage (no modifications needed)

### Task 3: Verify manifest after changes

**What**: Ensure manifest.json is valid and extension loads correctly

**How**:
1. Check JSON syntax validity
2. Run build process (npm run build or vite build)
3. Verify dist/manifest.json contains history permission

**Files Modified**:
- None (verification only)

**Success Criteria**:
- [ ] Build succeeds without errors
- [ ] dist/manifest.json contains "history" permission
- [ ] No manifest validation errors

## Verification

**How to verify this plan is complete:**

1. **File Check**: manifest.json contains "history" in permissions array
2. **Build Check**: Run `npm run build` or `vite build` succeeds
3. **Output Check**: dist/manifest.json contains "history" permission
4. **Extension Load**: Extension can be loaded in chrome://extensions (manual test)

**Expected Outcomes:**
- manifest.json permissions array has 2 items: "storage" and "history"
- Build process completes successfully
- Extension loads without manifest errors
- Chrome History API will be accessible in subsequent phases

## Risks & Mitigations

**Risk**: User denies history permission on install
**Mitigation**: Permission is requested at install time, clearly documented in extension description

**Risk**: Breaking existing functionality
**Mitigation**: Only adding permission, not modifying existing code or permissions

**Risk**: Invalid JSON syntax
**Mitigation**: Verify JSON validity before committing

## Notes

- This is a straightforward permission addition
- No code changes required in this phase
- CSP verification confirms no conflicts with history API usage
- This enables Phase 2 (History Service) to proceed

## Related Files

- manifest.json (primary modification target)
- dist/manifest.json (build output - auto-generated)

## Definition of Done

- [ ] manifest.json contains "history" permission
- [ ] Build completes successfully
- [ ] dist/manifest.json reflects changes
- [ ] No manifest validation errors
- [ ] Extension loads in Chrome
- [ ] Git commit created
- [ ] Ready to proceed to Phase 2

---

**Plan Template Version**: 1.0
**Last Updated**: 2026-01-09
